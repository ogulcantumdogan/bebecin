<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUS Hazırlık - Bebecin edition ♥</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF69B4',
                        secondary: '#FFB6C1',
                        accent: '#FFC0CB',
                        dark: '#333333',
                        light: '#FFF0F5'
                    },
                    keyframes: {
                        heartbeat: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.1)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    },
                    animation: {
                        heartbeat: 'heartbeat 1.5s ease-in-out infinite',
                        float: 'float 3s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #FFF0F5;
            min-height: 100vh;
        }
        
        .card {
            perspective: 1000px;
            transition: transform 0.6s;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 1rem;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .card-front {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
        }
        
        .card-back {
            background: white;
            color: #333;
            transform: rotateY(180deg);
            border: 2px solid #FF69B4;
        }
        
        .heart-checkbox {
            clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z');
            transition: all 0.3s;
        }
        
        .heart-checkbox:checked {
            background-color: #FF69B4;
        }
        
        /* Confetti animation */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(720deg); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 1000;
            animation: confetti-fall 5s linear forwards;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 300px;
            z-index: 9999;
            transform: translateX(100%);
            transition: transform 0.4s ease-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        /* Custom loader */
        .heart-loader {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
        }
        
        .heart-loader:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FF69B4'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E") no-repeat center center;
            animation: heartbeat 1.2s infinite;
        }

        /* Improve progress bar for small percentages */
        .progress-dot {
            width: 10px;
            height: 10px;
            background-color: #FF69B4;
            border-radius: 50%;
            position: absolute;
            top: -3px;
            right: -5px;
        }

        /* Mobile-specific styles */
        @media (max-width: 640px) {
            .mobile-nav-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-gap: 8px;
            }
            
            .mobile-nav-grid button {
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-light">
    <!-- Main container -->
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- Header -->
        <header class="mb-6 text-center animate__animated animate__fadeIn">
            <h1 class="text-4xl font-bold text-primary mb-1">DUS Hazırlık Kartları - Bebecin Edition</h1>
            <p class="text-gray-600 italic">Seni seviyorum, başaracağına inanıyorum ♥</p>
        </header>
        
        <!-- Statistics Display -->
        <div class="stats-container mb-5 bg-white rounded-lg shadow-md p-3 animate__animated animate__fadeIn animate__delay-1s">
            <div class="flex flex-wrap justify-around">
                <div class="stat-item text-center p-2">
                    <p class="text-sm text-gray-500">İlerleme</p>
                    <div class="progress-container relative h-4 bg-gray-200 rounded-full mt-1 w-60">
                        <div id="progress-bar" class="absolute top-0 left-0 h-full bg-primary rounded-full min-w-[4px]" style="width: 0%">
                            <div id="progress-dot" class="progress-dot hidden"></div>
                        </div>
                    </div>
                    <p id="progress-text" class="text-sm mt-1">0/0 soru</p>
                </div>
                
                <div class="stat-item text-center p-2">
                    <p class="text-sm text-gray-500">Doğru Bilinen</p>
                    <p id="known-count" class="text-xl font-bold text-green-500">0</p>
                </div>
                
                <div class="stat-item text-center p-2">
                    <p class="text-sm text-gray-500">Tekrar Et</p>
                    <p id="review-count" class="text-xl font-bold text-red-500">0</p>
                </div>
            </div>
        </div>
        
        <!-- Navigation Controls -->
        <div class="controls mb-4 bg-white rounded-lg shadow-md p-3 animate__animated animate__fadeIn animate__delay-1s">
            <div class="hidden sm:flex sm:flex-wrap sm:justify-between sm:items-center">
                <div class="buttons-left flex space-x-2">
                    <button id="prev-btn" class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-primary transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span>← Önceki</span>
                    </button>
                    <button id="next-btn" class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-primary transition duration-300">
                        <span>Sonraki →</span>
                    </button>
                </div>
                
                <div class="buttons-right flex space-x-2">
                    <button id="shuffle-btn" class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-pink-400 transition duration-300">
                        <span>Karıştır</span>
                    </button>
                    <button id="reset-btn" class="px-4 py-2 bg-red-400 text-white rounded-lg hover:bg-red-500 transition duration-300">
                        <span>Sıfırla</span>
                    </button>
                </div>
            </div>
            
            <!-- Mobile-specific navigation layout -->
            <div class="mobile-nav-grid sm:hidden">
                <button id="prev-btn-mobile" class="px-4 py-3 bg-secondary text-white rounded-lg hover:bg-primary transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span>← Önceki</span>
                </button>
                <button id="next-btn-mobile" class="px-4 py-3 bg-secondary text-white rounded-lg hover:bg-primary transition duration-300">
                    <span>Sonraki →</span>
                </button>
                <button id="shuffle-btn-mobile" class="px-4 py-3 bg-accent text-white rounded-lg hover:bg-pink-400 transition duration-300 mt-2">
                    <span>Karıştır</span>
                </button>
                <button id="reset-btn-mobile" class="px-4 py-3 bg-red-400 text-white rounded-lg hover:bg-red-500 transition duration-300 mt-2">
                    <span>Sıfırla</span>
                </button>
            </div>
        </div>
        
        <!-- Card Container -->
        <div class="card-container mb-4 h-80 animate__animated animate__zoomIn">
            <div id="card" class="card w-full h-full shadow-xl">
                <div class="card-inner h-full">
                    <div class="card-front flex flex-col justify-center items-center">
                        <h2 class="text-2xl font-bold mb-4">Soru</h2>
                        <p id="question-text" class="text-xl text-center leading-relaxed px-4">Soruları yükleniyor...</p>
                    </div>
                    <div class="card-back flex flex-col justify-center items-center">
                        <h2 class="text-2xl font-bold mb-4 text-primary">Cevap</h2>
                        <p id="answer-text" class="text-xl text-center leading-relaxed px-4">Cevap yükleniyor...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Rating and Flip Container -->
        <div class="action-container bg-white rounded-lg shadow-md p-4 mb-4 animate__animated animate__fadeIn animate__delay-2s">
            <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-4">
                <button id="flip-btn" class="w-full md:w-auto px-5 py-3 bg-primary text-white rounded-lg hover:bg-pink-600 transition duration-300 text-lg font-medium">
                    <span>Cevabı Göster</span>
                </button>
                
                <div class="flex justify-center space-x-4 w-full md:w-auto">
                    <button id="known-btn" class="w-full px-5 py-3 bg-green-400 text-white rounded-lg hover:bg-green-500 transition duration-300 text-lg font-medium">
                        <span>Biliyorum</span>
                    </button>
                    <button id="review-btn" class="w-full px-5 py-3 bg-red-400 text-white rounded-lg hover:bg-red-500 transition duration-300 text-lg font-medium">
                        <span>Tekrar Et</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm mt-4 animate__animated animate__fadeIn animate__delay-2s">
            <p>Günmaru, 2025 ♥</p>
        </footer>
    </div>
    
    <!-- Notification container -->
    <div id="notification" class="notification bg-white shadow-lg rounded-lg p-4 border-l-4 border-primary">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-3">
                <p id="notification-text" class="text-sm text-gray-700"></p>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-80 flex justify-center items-center z-50">
        <div class="text-center">
            <div class="heart-loader mb-4"></div>
            <p class="text-primary font-medium">Sınav hazırlık kartları yükleniyor...</p>
        </div>
    </div>

    <script>
        // Load questions from external file or fallback to embedded questions
        let questionsData = [];
        
        // Function to load questions from JSON file
        async function loadQuestions() {
            try {
                const response = await fetch('sorular.json');
                if (response.ok) {
                    questionsData = await response.json();
                    console.log(`Loaded ${questionsData.length} questions from JSON file`);
                } else {
                    console.error('Failed to load questions from JSON file, using fallback questions');
                    initWithFallbackQuestions();
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                initWithFallbackQuestions();
            } finally {
                initApp();
            }
        }
        
        // Fallback questions if JSON file is not available
        function initWithFallbackQuestions() {
            questionsData = [
                { id: "q001", question: "Gram boyamada mordan nedir?", answer: "Boyayı hücreye bağlayan maddedir. İodine (İyot) kullanılır." },
                { id: "q002", question: "Kist ile abse arasındaki farklar nelerdir?", answer: "Kist: Oluşum yavaştır, epitel doku ile çevrilidir, sıvı berrak ve visközdür, normal doku basınç etkisiyle ezilir. Abse: İnflamasyonla hızlı oluşur, piyojenik membranla çevrilidir, içi püy doludur, normal doku lizis ile yıkılır." },
                { id: "q003", question: "Mycobacterium tuberculosis'in virülans faktörleri nelerdir?", answer: "Cord faktör (Trehaloz dimikolat), Sülfatidler (Sulfatides)" },
                // More fallback questions can be added here
            ];
        }

        // Personal messages that will appear randomly
        const personalMessages = [
            "Seni çok seviyorum bebeimmm! ♥",
            "Harika bir diş hekimi olacaksın!",
            "Yanındayım askmmm!",
            "Akıllı bıdık <3",
            "Yakında kavuşacağız aşkım <333",
            "Biraz mola verip dinlenmeyi unutma bitanem!!!!"
        ];

        // App state
        let state = {
            currentIndex: 0,
            knownQuestions: {},
            reviewQuestions: {},
            questionsOrder: [],
            isCardFlipped: false
        };

        // DOM Elements
        const card = document.getElementById('card');
        const questionText = document.getElementById('question-text');
        const answerText = document.getElementById('answer-text');
        const progressBar = document.getElementById('progress-bar');
        const progressDot = document.getElementById('progress-dot');
        const progressText = document.getElementById('progress-text');
        const knownCount = document.getElementById('known-count');
        const reviewCount = document.getElementById('review-count');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtnMobile = document.getElementById('prev-btn-mobile');
        const nextBtnMobile = document.getElementById('next-btn-mobile');
        const flipBtn = document.getElementById('flip-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const shuffleBtnMobile = document.getElementById('shuffle-btn-mobile');
        const resetBtn = document.getElementById('reset-btn');
        const resetBtnMobile = document.getElementById('reset-btn-mobile');
        const knownBtn = document.getElementById('known-btn');
        const reviewBtn = document.getElementById('review-btn');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        const loadingOverlay = document.getElementById('loading-overlay');

        // Helper function to get question ID consistently
        function getQuestionId(questionIndex) {
            if (questionIndex < 0 || questionIndex >= questionsData.length) {
                return null;
            }
            const question = questionsData[questionIndex];
            return question.id || questionIndex.toString();
        }

        // Initialize the app
        function initApp() {
            loadState();
            
            if (state.questionsOrder.length === 0 || state.questionsOrder.length !== questionsData.length) {
                // First time initialization or questions count changed
                state.questionsOrder = Array.from({ length: questionsData.length }, (_, i) => i);
            }

            // Ensure currentIndex is valid
            validateCurrentIndex();
            
            updateUI();
            setTimeout(() => {
                loadingOverlay.classList.add('animate__animated', 'animate__fadeOut');
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 500);
            }, 1500);
            
            // Show a random personal message after a delay
            setTimeout(showRandomMessage, 10000);
        }

        // Validate and correct currentIndex if needed
        function validateCurrentIndex() {
            if (questionsData.length === 0) {
                state.currentIndex = 0;
                return;
            }
            
            if (state.currentIndex < 0) {
                state.currentIndex = 0;
            } else if (state.currentIndex >= questionsData.length) {
                state.currentIndex = questionsData.length - 1;
            }
        }

        // Load state from localStorage
        function loadState() {
            try {
                const savedState = localStorage.getItem('medicalQuizState');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    state = { ...state, ...parsedState };
                }
            } catch (e) {
                console.error('Failed to parse saved state:', e);
                // Reset to default state on error
                state = {
                    currentIndex: 0,
                    knownQuestions: {},
                    reviewQuestions: {},
                    questionsOrder: [],
                    isCardFlipped: false
                };
            }
        }

        // Save state to localStorage
        function saveState() {
            try {
                localStorage.setItem('medicalQuizState', JSON.stringify({
                    currentIndex: state.currentIndex,
                    knownQuestions: state.knownQuestions,
                    reviewQuestions: state.reviewQuestions,
                    questionsOrder: state.questionsOrder
                }));
            } catch (e) {
                console.error('Failed to save state:', e);
                showNotification("Hata: İlerleme kaydedilemedi.", 3000);
            }
        }

        // Update UI elements based on current state
        function updateUI() {
            if (questionsData.length === 0) {
                questionText.textContent = "Henüz soru eklenmemiş.";
                answerText.textContent = "Lütfen soru ekleyin.";
                disableControls(true);
                return;
            }
            
            validateCurrentIndex();
            
            const currentQuestionIndex = state.questionsOrder[state.currentIndex];
            // Check if index is valid
            if (currentQuestionIndex === undefined || !questionsData[currentQuestionIndex]) {
                console.error("Invalid question index:", currentQuestionIndex);
                state.currentIndex = 0;
                updateUI();
                return;
            }
            
            const currentQuestion = questionsData[currentQuestionIndex];
            
            // Update question and answer text
            questionText.textContent = currentQuestion.question || "Soru bulunamadı";
            answerText.textContent = currentQuestion.answer || "Cevap bulunamadı";
            
            // Reset card flip state
            if (state.isCardFlipped) {
                card.classList.remove('flipped');
                state.isCardFlipped = false;
                flipBtn.textContent = "Cevabı Göster";
            }
            
            // Update progress indicators
            const knownTotal = Object.keys(state.knownQuestions).length;
            const reviewTotal = Object.keys(state.reviewQuestions).length;
            const progress = questionsData.length > 0 ? Math.round((knownTotal / questionsData.length) * 100) : 0;
            
            // Improve progress bar display for small percentages
            if (knownTotal > 0 && progress < 2) {
                progressBar.style.width = '4px';
                progressDot.classList.remove('hidden');
            } else {
                progressBar.style.width = `${progress}%`;
                progressDot.classList.add('hidden');
            }
            
            progressText.textContent = `${state.currentIndex + 1}/${questionsData.length} soru`;
            knownCount.textContent = knownTotal;
            reviewCount.textContent = reviewTotal;
            
            // Update button states
            const isFirstQuestion = state.currentIndex === 0;
            const isLastQuestion = state.currentIndex === questionsData.length - 1;
            
            prevBtn.disabled = isFirstQuestion;
            prevBtnMobile.disabled = isFirstQuestion;
            nextBtn.disabled = isLastQuestion;
            nextBtnMobile.disabled = isLastQuestion;
            
            // Highlight button if current question is marked
            const currentId = getQuestionId(currentQuestionIndex);
            knownBtn.classList.remove('ring-4', 'ring-green-200');
            reviewBtn.classList.remove('ring-4', 'ring-red-200');
            
            if (currentId && state.knownQuestions[currentId]) {
                knownBtn.classList.add('ring-4', 'ring-green-200');
            } else if (currentId && state.reviewQuestions[currentId]) {
                reviewBtn.classList.add('ring-4', 'ring-red-200');
            }
            
            try {
                saveState();
            } catch (e) {
                console.error('Failed to save state:', e);
            }
        }

        // Flip the card to show answer
        function flipCard() {
            card.classList.toggle('flipped');
            state.isCardFlipped = !state.isCardFlipped;
            
            if (state.isCardFlipped) {
                flipBtn.textContent = "Soruyu Göster";
            } else {
                flipBtn.textContent = "Cevabı Göster";
            }
        }

        // Move to the next question
        function nextQuestion() {
            if (state.currentIndex < questionsData.length - 1) {
                state.currentIndex++;
                updateUI();
            }
        }

        // Move to the previous question
        function previousQuestion() {
            if (state.currentIndex > 0) {
                state.currentIndex--;
                updateUI();
            }
        }

        // Mark current question as known
        function markAsKnown() {
            const currentQuestionIndex = state.questionsOrder[state.currentIndex];
            if (currentQuestionIndex === undefined || currentQuestionIndex < 0 || 
                currentQuestionIndex >= questionsData.length) {
                console.error("Invalid question index for marking as known");
                return;
            }
            
            const currentId = getQuestionId(currentQuestionIndex);
            if (!currentId) {
                console.error("Cannot get valid ID for current question");
                return;
            }
            
            // If already marked as review, remove that mark
            if (state.reviewQuestions[currentId]) {
                delete state.reviewQuestions[currentId];
            }
            
            // Toggle known status
            if (state.knownQuestions[currentId]) {
                delete state.knownQuestions[currentId];
                showNotification("Soru bilinmiyor olarak işaretlendi.");
            } else {
                state.knownQuestions[currentId] = true;
                showNotification("Soru biliniyor olarak işaretlendi! 🎉");
                createConfetti(10);
                
                // Check if we reached a milestone
                const knownTotal = Object.keys(state.knownQuestions).length;
                if (knownTotal % 10 === 0) {
                    setTimeout(() => {
                        showNotification(`Tebrikler! ${knownTotal} soruyu biliyorsun! 🥳`, 3000);
                        createConfetti(30);
                    }, 1000);
                }
            }
            
            updateUI();
            
            // Automatically move to next question if this isn't the last one
            if (state.currentIndex < questionsData.length - 1) {
                setTimeout(nextQuestion, 800);
            }
        }

        // Mark current question for review
        function markForReview() {
            const currentQuestionIndex = state.questionsOrder[state.currentIndex];
            if (currentQuestionIndex === undefined || currentQuestionIndex < 0 || 
                currentQuestionIndex >= questionsData.length) {
                console.error("Invalid question index for marking for review");
                return;
            }
            
            const currentId = getQuestionId(currentQuestionIndex);
            if (!currentId) {
                console.error("Cannot get valid ID for current question");
                return;
            }
            
            // If already marked as known, remove that mark
            if (state.knownQuestions[currentId]) {
                delete state.knownQuestions[currentId];
            }
            
            // Toggle review status
            if (state.reviewQuestions[currentId]) {
                delete state.reviewQuestions[currentId];
                showNotification("Soru tekrar listesinden çıkarıldı.");
            } else {
                state.reviewQuestions[currentId] = true;
                showNotification("Soru tekrar edilecek olarak işaretlendi.");
            }
            
            updateUI();
            
            // Automatically move to next question if this isn't the last one
            if (state.currentIndex < questionsData.length - 1) {
                setTimeout(nextQuestion, 800);
            }
        }

        // Shuffle the questions
        function shuffleQuestions() {
            if (questionsData.length <= 1) {
                showNotification("Karıştırmak için en az 2 soru gerekiyor.");
                return;
            }
            
            state.questionsOrder = shuffleArray([...state.questionsOrder]);
            state.currentIndex = 0;
            showNotification("Sorular karıştırıldı!");
            updateUI();
        }

        // Reset progress
        function resetProgress() {
            if (confirm("Tüm ilerlemeniz sıfırlanacak. Emin misiniz?")) {
                state.knownQuestions = {};
                state.reviewQuestions = {};
                state.currentIndex = 0;
                showNotification("İlerleme sıfırlandı.");
                updateUI();
            }
        }

        // Show notification message
        function showNotification(message, duration = 2000) {
            if (!message) return;
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        // Create confetti effect
        function createConfetti(count = 20) {
            const colors = ['#FF69B4', '#FFB6C1', '#FFC0CB', '#FF1493', '#FFA07A'];
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                confetti.style.opacity = Math.random() + 0.5;
                document.body.appendChild(confetti);
                
                // Remove confetti after animation completes
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Show a random personal message
        function showRandomMessage() {
            if (personalMessages.length > 0) {
                const message = personalMessages[Math.floor(Math.random() * personalMessages.length)];
                showNotification(message, 4000);
                
                // Schedule next message between 30s and 2min
                const nextTime = Math.random() * 90000 + 30000;
                setTimeout(showRandomMessage, nextTime);
            }
        }

        // Helper function to shuffle an array
        function shuffleArray(array) {
            if (!Array.isArray(array) || array.length === 0) {
                return array;
            }
            
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Helper function to disable all controls
        function disableControls(disabled) {
            prevBtn.disabled = disabled;
            nextBtn.disabled = disabled;
            prevBtnMobile.disabled = disabled;
            nextBtnMobile.disabled = disabled;
            flipBtn.disabled = disabled;
            shuffleBtn.disabled = disabled;
            shuffleBtnMobile.disabled = disabled;
            resetBtn.disabled = disabled;
            resetBtnMobile.disabled = disabled;
            knownBtn.disabled = disabled;
            reviewBtn.disabled = disabled;
        }

        // Event listeners
        flipBtn.addEventListener('click', flipCard);
        nextBtn.addEventListener('click', nextQuestion);
        prevBtn.addEventListener('click', previousQuestion);
        nextBtnMobile.addEventListener('click', nextQuestion);
        prevBtnMobile.addEventListener('click', previousQuestion);
        knownBtn.addEventListener('click', markAsKnown);
        reviewBtn.addEventListener('click', markForReview);
        shuffleBtn.addEventListener('click', shuffleQuestions);
        shuffleBtnMobile.addEventListener('click', shuffleQuestions);
        resetBtn.addEventListener('click', resetProgress);
        resetBtnMobile.addEventListener('click', resetProgress);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextQuestion();
            else if (e.key === 'ArrowLeft') previousQuestion();
            else if (e.key === ' ' || e.key === 'Enter') flipCard();
            else if (e.key === 'k') markAsKnown();
            else if (e.key === 'r') markForReview();
        });

        // Handle window errors
        window.onerror = function(message, source, lineno, colno, error) {
            console.error("Error caught:", message, "at", source, ":", lineno, ":", colno);
            showNotification("Bir hata oluştu: " + message, 5000);
            return true; // Prevents default error handling
        };

        // Start loading questions
        loadQuestions();
    </script>
</body>
</html>